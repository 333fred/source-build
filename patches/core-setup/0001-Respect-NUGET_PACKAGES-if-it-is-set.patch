From f115103448c7a7119fad694cf9928d8102a3eb92 Mon Sep 17 00:00:00 2001
From: Matt Ellis <matell@microsoft.com>
Date: Mon, 15 May 2017 18:45:21 -0700
Subject: [PATCH 1/3] Respect NUGET_PACKAGES if it is set

---
 dir.props           | 1 +
 src/pkg/dir.targets | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/dir.props b/dir.props
index 3a79abc7..cbb2519f 100644
--- a/dir.props
+++ b/dir.props
@@ -42,6 +42,7 @@
     <BaseIntermediateOutputPath Condition="'$(BaseIntermediateOutputPath)'==''">$(ObjDir)</BaseIntermediateOutputPath>
 
     <!-- Input Directories -->
+    <PackagesDir Condition="'$(PackagesDir)'==''">$(NUGET_PACKAGES)</PackagesDir>
     <PackagesDir Condition="'$(PackagesDir)'==''">$(ProjectDir)packages/</PackagesDir>
     <ToolRuntimePath Condition="'$(ToolRuntimePath)'==''">$(ProjectDir)Tools/</ToolRuntimePath>
     <LocalToolRuntimePath Condition="'$(LocalToolRuntimePath)' == ''">$(ToolRuntimePath)local/</LocalToolRuntimePath>
diff --git a/src/pkg/dir.targets b/src/pkg/dir.targets
index b785ba53..85ed8815 100644
--- a/src/pkg/dir.targets
+++ b/src/pkg/dir.targets
@@ -2,6 +2,6 @@
 <Project ToolsVersion="12.0" InitialTargets="CheckForBuildTools" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
     <Import Project="..\dir.targets" />
     <PropertyGroup>
-        <RuntimeIdGraphDefinitionFile>$(ProjectDir)packages\$(PlatformPackageId.ToLowerInvariant())\$(PlatformPackageVersion)\runtime.json</RuntimeIdGraphDefinitionFile>
+        <RuntimeIdGraphDefinitionFile>$(PackagesDir)$(PlatformPackageId.ToLowerInvariant())\$(PlatformPackageVersion)\runtime.json</RuntimeIdGraphDefinitionFile>
     </PropertyGroup>
 </Project>
-- 
2.11.0

