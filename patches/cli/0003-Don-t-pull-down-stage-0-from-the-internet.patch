From a0198716a03a9fdca82125487a4223cc55a06f5c Mon Sep 17 00:00:00 2001
From: Matt Ellis <matell@microsoft.com>
Date: Mon, 22 May 2017 11:37:59 -0700
Subject: [PATCH 3/3] Don't pull down stage 0 from the internet

The composed build will set `PREBUILT_DOTNET_TOOL_DIR` to a location
where the dotnet tool can be copied from.

Long term we should get rid of the copy in favor of just using one
from a common location, but some of the Stage0 logic in the CLI build
system will need to change, I think.
---
 run-build.sh | 15 +--------------
 1 file changed, 1 insertion(+), 14 deletions(-)

diff --git a/run-build.sh b/run-build.sh
index 726e6d3bd..3faab1ffd 100755
--- a/run-build.sh
+++ b/run-build.sh
@@ -155,20 +155,7 @@ export VSTEST_TRACE_BUILD=1
 DOTNET_MULTILEVEL_LOOKUP=0
 
 # Install a stage 0
-(set -x ; "$REPOROOT/scripts/obtain/dotnet-install.sh" --channel "master" --version "2.0.0-preview1-005867" --install-dir "$DOTNET_INSTALL_DIR" --architecture "$ARCHITECTURE" $LINUX_PORTABLE_INSTALL_ARGS)
-EXIT_CODE=$?
-if [ $EXIT_CODE != 0 ]; then
-    echo "run-build: Error: installing stage0 with exit code $EXIT_CODE." >&2
-    exit $EXIT_CODE
-fi
-
-# Install a project.json based CLI for use by tests
-(set -x ; "$REPOROOT/scripts/obtain/dotnet-install.sh" --channel "master" --install-dir "$DOTNET_INSTALL_DIR_PJ" --architecture "$ARCHITECTURE" --version "1.0.0-preview2-1-003177")
-EXIT_CODE=$?
-if [ $EXIT_CODE != 0 ]; then
-    echo "run-build: Error: installing project-json based cli failed with exit code $EXIT_CODE." >&2
-    exit $EXIT_CODE
-fi
+cp -r "$DOTNET_TOOL_DIR" "$DOTNET_INSTALL_DIR"
 
 # Put stage 0 on the PATH (for this shell only)
 PATH="$DOTNET_INSTALL_DIR:$PATH"
-- 
2.11.0

