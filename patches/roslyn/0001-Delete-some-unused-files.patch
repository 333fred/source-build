From b73f2738ed7bec32e4e65a2271924dd2f712d79d Mon Sep 17 00:00:00 2001
From: Matt Ellis <matell@microsoft.com>
Date: Fri, 12 May 2017 17:20:51 -0700
Subject: [PATCH 1/5] Delete some unused files

---
 build/MSBuildToolset/MSBuildToolset.xproj          |  20 ----
 build/MSBuildToolset/Program.cs                    | 117 ---------------------
 build/MSBuildToolset/build-toolset.ps1             | 117 ---------------------
 build/MSBuildToolset/csc                           |   6 --
 build/MSBuildToolset/project.json                  |  37 -------
 build/MSBuildToolset/vbc                           |   7 --
 docs/infrastructure/unix-toolset.md                |  29 -----
 .../DeployToolsetCompiler.csproj                   |  33 ------
 src/Deployment/DeployToolsetCompiler/Program.cs    |   9 --
 src/Deployment/DeployToolsetCompiler/project.json  |  11 --
 10 files changed, 386 deletions(-)
 delete mode 100644 build/MSBuildToolset/MSBuildToolset.xproj
 delete mode 100644 build/MSBuildToolset/Program.cs
 delete mode 100644 build/MSBuildToolset/build-toolset.ps1
 delete mode 100755 build/MSBuildToolset/csc
 delete mode 100644 build/MSBuildToolset/project.json
 delete mode 100755 build/MSBuildToolset/vbc
 delete mode 100644 docs/infrastructure/unix-toolset.md
 delete mode 100644 src/Deployment/DeployToolsetCompiler/DeployToolsetCompiler.csproj
 delete mode 100644 src/Deployment/DeployToolsetCompiler/Program.cs
 delete mode 100644 src/Deployment/DeployToolsetCompiler/project.json

diff --git a/build/MSBuildToolset/MSBuildToolset.xproj b/build/MSBuildToolset/MSBuildToolset.xproj
deleted file mode 100644
index 1547975..0000000
--- a/build/MSBuildToolset/MSBuildToolset.xproj
+++ /dev/null
@@ -1,20 +0,0 @@
-﻿<?xml version="1.0" encoding="utf-8"?>
-<!-- Copyright (c)  Microsoft.  All Rights Reserved.  Licensed under the Apache License, Version 2.0.  See License.txt in the project root for license information. -->
-<Project ToolsVersion="14.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
-  <PropertyGroup>
-    <VisualStudioVersion Condition="'$(VisualStudioVersion)' == ''">14.0</VisualStudioVersion>
-    <VSToolsPath Condition="'$(VSToolsPath)' == ''">$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)</VSToolsPath>
-  </PropertyGroup>
-  <Import Project="$(VSToolsPath)\DNX\Microsoft.DNX.Props" Condition="'$(VSToolsPath)' != ''" />
-  <PropertyGroup Label="Globals">
-    <ProjectGuid>8dbdafe5-a5ef-4115-804c-ac62fd586957</ProjectGuid>
-    <RootNamespace>MSBuildToolset</RootNamespace>
-    <BaseIntermediateOutputPath Condition="'$(BaseIntermediateOutputPath)' == ''">..\artifacts\obj\$(MSBuildProjectName)</BaseIntermediateOutputPath>
-    <OutputPath Condition="'$(OutputPath)' == ''">..\artifacts\bin\$(MSBuildProjectName)\</OutputPath>
-  </PropertyGroup>
-
-  <PropertyGroup>
-    <SchemaVersion>2.0</SchemaVersion>
-  </PropertyGroup>
-  <Import Project="$(VSToolsPath)\DNX\Microsoft.DNX.targets" Condition="'$(VSToolsPath)' != ''" />
-</Project>
\ No newline at end of file
diff --git a/build/MSBuildToolset/Program.cs b/build/MSBuildToolset/Program.cs
deleted file mode 100644
index 4ba63b1..0000000
--- a/build/MSBuildToolset/Program.cs
+++ /dev/null
@@ -1,117 +0,0 @@
-﻿// Copyright (c) Microsoft.  All Rights Reserved.  Licensed under the Apache License, Version 2.0.  See License.txt in the project root for license information.
-using System;
-using System.Diagnostics;
-using System.IO;
-using System.Linq;
-using System.Text;
-using Microsoft.Build.Construction;
-
-namespace MSBuildToolset
-{
-    public sealed class Program
-    {
-        public static int Main(string[] args)
-        {
-            if (args.Length != 3)
-            {
-                Console.WriteLine("Usage: RoslynRestore <solutionFile> <nugetExePath> <dotnetPath>");
-                return -1;
-            }
-
-            var nugetExePath = Path.GetFullPath(args[1]);
-            var dotnetPath = Path.GetFullPath(args[2]);
-
-            var solutionFile = SolutionFile.Parse(args[0]);
-            var projectPaths = solutionFile.ProjectsInOrder
-                .Select(p => p.AbsolutePath)
-                .Select(p => p.Replace('\\', '/'))
-                .Where(p => !p.EndsWith("shproj") && p.EndsWith("proj"))
-                .ToArray();
-
-            var nugetExeDir = Path.GetDirectoryName(nugetExePath);
-            string msbuildPath = Path.Combine(AppContext.BaseDirectory, "MSBuild.dll");
-            string entryPointTargetPath = Path.Combine(nugetExeDir,
-                "build/Targets/GetProjectsReferencingProjectJsonFilesEntryPoint.targets");
-            string afterBuildsTargetPath = Path.Combine(nugetExeDir,
-                "build/Targets/GetProjectsReferencingProjectJsonFiles.targets");
-            string resultsFilePath = Path.ChangeExtension(Path.GetTempFileName(), "dg");
-
-            // Build up a command line to run a specific MSBuild target
-            // (NuGet_GetProjectsReferencingProjectJson) against every project
-            // in the solution. This target spits out all the P2P references of
-            // the project, eventually combined into a .dg with a graph of all the
-            // P2P references in the solution. This file is eventually passed to
-            // dotnet restore, where it is used by NuGet to resolve packages across
-            // P2P references.
-            var argumentBuilder = new StringBuilder(
-                $"\"{msbuildPath}\" " +
-                "-t:NuGet_GetProjectsReferencingProjectJson " +
-                "-nologo -v:q " +
-                "-p:BuildProjectReferences=false " +
-                $"-p:NuGetTasksAssemblyPath=\"{nugetExePath}\" " +
-                $"-p:NuGetCustomAfterBuildTargetPath=\"{afterBuildsTargetPath}\" " +
-                $"-p:ResultsFile=\"{resultsFilePath}\" " +
-                $"-p:NuGet_ProjectReferenceToResolve=\"\\\"");
-
-            foreach (var projectPath in projectPaths)
-            {
-                argumentBuilder.Append(projectPath).Append(";");
-            }
-
-            argumentBuilder.Append("\\\"\" ");
-            argumentBuilder.Append($"\"{entryPointTargetPath}\"");
-
-            var arguments = argumentBuilder.ToString();
-
-            var psi = new ProcessStartInfo
-            {
-                UseShellExecute = false,
-                FileName = Path.Combine(AppContext.BaseDirectory, "corerun"),
-                Arguments = arguments
-            };
-
-            using (var process = Process.Start(psi))
-            {
-                process.WaitForExit();
-                
-                if (process.ExitCode != 0)
-                {
-                    Console.Error.WriteLine("MSBuild dg file generation failed");
-                    return -1;
-                }
-            }
-
-            // Run dotnet restore with the aforementioned .dg P2P file
-            arguments = $"restore --disable-parallel -v Warning {resultsFilePath}";
-
-            psi = new ProcessStartInfo
-            {
-                UseShellExecute = false,
-                FileName = dotnetPath,
-                Arguments = arguments
-            };
-
-            using (var process = Process.Start(psi))
-            {
-                process.WaitForExit();
-
-                if (process.ExitCode != 0)
-                {
-                    Console.Error.WriteLine("Restore failed");
-                    return -1;
-                }
-            }
-
-            try
-            {
-                File.Delete(resultsFilePath);
-            }
-            catch
-            {
-                // Ignore failure
-            }
-
-            return 0;
-        }
-    }
-}
diff --git a/build/MSBuildToolset/build-toolset.ps1 b/build/MSBuildToolset/build-toolset.ps1
deleted file mode 100644
index 8d05018..0000000
--- a/build/MSBuildToolset/build-toolset.ps1
+++ /dev/null
@@ -1,117 +0,0 @@
-﻿# Builds the toolset for use in unix msbuild-coreclr
-param (
-    [string]$NuGetTaskDir,
-    [string]$RoslynDropDir,
-    [string]$DotNetPath = "dotnet"
-)
-
-function ZipFiles($sourceDir, $zipPath)
-{
-   If (Test-Path $zipPath)
-   {
-       Remove-Item $zipPath
-   }
-
-   Add-Type -Assembly System.IO.Compression.FileSystem
-   [System.IO.Compression.ZipFile]::CreateFromDirectory($sourceDir, $zipPath, [System.IO.Compression.CompressionLevel]::Optimal, $false)
-}
-
-$ErrorActionPreference="Stop"
-
-try
-{
-    pushd $PSScriptRoot
-
-    & $DotNetPath restore
-
-    $outputRoot = "$PSScriptRoot\bin\Debug\netcoreapp1.0"
-
-    foreach ($TargetRuntime in ("ubuntu.14.04-x64","osx.10.10-x64"))
-    {
-        & $DotNetPath publish -r $TargetRuntime
-
-        $publishDir = "$outputRoot\$TargetRuntime\publish"
-
-        # Fix up AssignLinkMetadata
-        # TODO(https://github.com/Microsoft/msbuild/issues/544)
-        $curVersionTargets = "$publishDir\Microsoft.Common.CurrentVersion.targets"
-        (Get-Content $curVersionTargets).replace(';AssignLinkMetadata</PrepareForBuildDependsOn>', '</PrepareForBuildDependsOn>') | Set-Content $curVersionTargets
-
-        # Set up tasks and targets
-        $extensionsMSDir = "$publishDir\Extensions\Microsoft"
-        $nugetExtensionsDir = "$extensionsMSDir\NuGet"
-
-        # TODO(https://github.com/dotnet/roslyn/issues/9642)
-        # Copy the NuGet tasks/targets
-        mkdir -Force $nugetExtensionsDir
-        Copy-Item -Force "$NuGetTaskDir\*" $NuGetExtensionsDir
-
-        # Copy the portable targets
-        write-host "Copy portable targets"
-        Copy-Item -Force -Recurse (Join-Path ([Environment]::GetFolderPath("ProgramFilesX86")) "MSBuild\Microsoft\Portable") "$extensionsMSDir"
-        
-        # Copy over the portable build task
-        # TODO(https://github.com/dotnet/roslyn/issues/9640)
-        # Copy from a NuGet package instead of a build.
-        # Overwrite dlls pulled in by the references listed in project.json 
-        # (we want a specific toolset compiler version).
-        write-host "Copy portable build task"
-        foreach ($item in (
-            "CodeAnalysisBuildTask\Microsoft.Build.Tasks.CodeAnalysis.dll",
-            "CodeAnalysisBuildTask\Microsoft.CSharp.Core.targets",
-            "CodeAnalysisBuildTask\Microsoft.VisualBasic.Core.targets", 
-            "System.Reflection.Metadata.dll", 
-            "System.Collections.Immutable.dll", 
-            "Microsoft.CodeAnalysis.dll", 
-            "Microsoft.CodeAnalysis.CSharp.dll", 
-            "Microsoft.CodeAnalysis.VisualBasic.dll", 
-            "csccore\csc.exe", 
-            "vbccore\vbc.exe"))
-        {
-            Copy-Item (Join-Path $RoslynDropDir "20160525.2" $item) $publishDir
-        }
-
-        # Copy over the reference assemblies
-        $frameworkRefsDir = "$publishDir\reference-assemblies\Framework"
-        mkdir -Force "$frameworkRefsDir\.NETFramework"
-        
-        write-host "Copy .NETFramework/v4.5 reference assemblies"
-        Copy-Item -Force -Recurse (Join-Path ([Environment]::GetFolderPath("ProgramFilesX86")) "Reference Assemblies\Microsoft\Framework\.NETFramework\v4.5") "$frameworkRefsDir\.NETFramework"
-
-        write-host "Copy .NETPortable reference assemblies"
-        Copy-Item -Force -Recurse (Join-Path ([Environment]::GetFolderPath("ProgramFilesX86")) "Reference Assemblies\Microsoft\Framework\.NETPortable") $frameworkRefsDir
-
-        # Bug: https://github.com/Microsoft/msbuild/issues/522
-        # Reference assembly has a bad name, fixup
-        pushd "$publishDir\reference-assemblies\Framework\.NETFramework\v4.5"
-        Move-Item System.XML.dll System.Xml.dll
-        popd
-
-        # TODO(https://github.com/dotnet/roslyn/issues/9641)
-        # Portable CSharp targets have ref with wrong case
-        write-host "Copy portable targets files"
-        foreach ($version in ("v4.5","v5.0"))
-        {
-            $file = "$extensionsMSDir\Portable\$version\Microsoft.Portable.CSharp.targets"
-            (Get-Content $file) | %{ $_ -replace 'Microsoft.CSharp.Targets','Microsoft.CSharp.targets' } | Out-File $file
-        }
-
-        # Copy the helper scripts for csc/vbc
-        write-host "Copy helper scripts for csc"
-        Copy-Item -Force "$PSScriptRoot\..\..\src\Compilers\CSharp\CscCore\csc" $publishDir
-
-        write-host "Copy helper scripts for vbc"
-        Copy-Item -Force "$PSScriptRoot\..\..\src\Compilers\VisualBasic\VbcCore\vbc" $publishDir
-
-        $toolsetPackageZip = (Join-Path $outputRoot "$TargetRuntime.zip")
-        Write-Host "Zipping $publishDir to $toolsetPackageZip"
-        ZipFiles $publishDir $toolsetPackageZip
-    }
-
-    popd
-}
-catch
-{
-    write-host "Error: $($_.Exception.Message)"
-    exit 1
-}
diff --git a/build/MSBuildToolset/csc b/build/MSBuildToolset/csc
deleted file mode 100755
index a31464d..0000000
--- a/build/MSBuildToolset/csc
+++ /dev/null
@@ -1,6 +0,0 @@
-#!/bin/sh
-
-THISDIR=$(dirname $0)
-
-chmod +x $THISDIR/corerun 2>/dev/null
-$THISDIR/corerun $THISDIR/csc.exe "$@"
diff --git a/build/MSBuildToolset/project.json b/build/MSBuildToolset/project.json
deleted file mode 100644
index 6623f7e..0000000
--- a/build/MSBuildToolset/project.json
+++ /dev/null
@@ -1,37 +0,0 @@
-{
-  "version": "1.0.0-*",
-  "buildOptions": {
-    "emitEntryPoint": true,
-    "outputName": "RoslynRestore"
-  },
-  "publishOptions": {
-      "include": [ "csc", "vbc" ]
-  },
-  "dependencies": {
-    "Microsoft.Build": "15.1.0-preview-000458-02",
-    "Microsoft.Build.Runtime": "15.1.0-preview-000458-02",
-    "Microsoft.Build.Tasks.Core": "15.1.0-preview-000458-02",
-    "Microsoft.Net.Compilers.netcore": "2.0.0-rc4-61325-08",
-    "Microsoft.NuGet.Build.Tasks": "0.1.0",
-    "Microsoft.CodeAnalysis.Build.Tasks": "2.0.0-rc4-61325-08",
-    "Microsoft.NETCore.TestHost": "1.1.0",
-    "Microsoft.NETCore.App": "1.1.0",
-    "Microsoft.Portable.Targets": "0.1.2-dev",
-    "Newtonsoft.Json": "8.0.3",
-    "NuGet.CommandLine.XPlat": "3.5.0-beta2-1484"
-  },
-  "frameworks": {
-    "NETCoreApp1.1": {
-      "imports": [
-        "portable-net452",
-        "dotnet"
-      ]
-    }
-  },
-  "runtimes": {
-    "ubuntu.14.04-x64": {},
-    "ubuntu.16.04-x64": {},
-    "osx.10.11-x64": {},
-    "osx.10.12-x64": {}
-  }
-}
diff --git a/build/MSBuildToolset/vbc b/build/MSBuildToolset/vbc
deleted file mode 100755
index baf399f..0000000
--- a/build/MSBuildToolset/vbc
+++ /dev/null
@@ -1,7 +0,0 @@
-#!/bin/sh
-
-THISDIR=$(dirname $0)
-
-chmod +x $THISDIR/corerun 2>/dev/null
-$THISDIR/corerun $THISDIR/vbc.exe "$@"
-
diff --git a/docs/infrastructure/unix-toolset.md b/docs/infrastructure/unix-toolset.md
deleted file mode 100644
index 7946c32..0000000
--- a/docs/infrastructure/unix-toolset.md
+++ /dev/null
@@ -1,29 +0,0 @@
-Building a new Unix toolset
-====
-This document describes building a new toolset for use in Mac or Linux.
-Because the toolsets contain various targets and reference assemblies that
-only exist on Windows, the toolsets currently must be built on Windows.
-
-### Building Roslyn Toolset
-The new *toolset name* will be chosen as one of the follownig:
-
-- Linux: roslyn.linux.`<version number>`
-- Mac: roslyn.mac.`<version number>`
-
-The value of *version number* will simply be the one number higher than the current version number of the toolset.  
-
-To build the toolset do the following:
-
-- If necessary, make modifications to the dependencies in the 
- `build/MSBuildToolset/project.json` file to bring in anything new.
-- Run the `build/MSBuildToolset/build-toolset.ps1` file.
-- The script produces two zip files in bin\Debug\netcoreapp1.0 subdirectory:
-    - Rename `osx.10.10-x64.zip` to roslyn.mac.`<version number>.zip`
-    - Rename `ubuntu.14.04-x64.zip` to roslyn.linux.`<version number>.zip`
-- Upload the files to the Azure in the dotnetci storage account in the roslyn container:
-
-```
-azcopy /Pattern:*.zip /Source:build\MSBuildToolset\bin\Debug\netcoreapp1.0 /Dest:https://dotnetci.blob.core.windows.net/roslyn /DestKey:<<key>>
-```
-
-- Send a PR to change [Makefile](https://github.com/dotnet/roslyn/blob/master/Makefile) to use the new toolset.  
diff --git a/src/Deployment/DeployToolsetCompiler/DeployToolsetCompiler.csproj b/src/Deployment/DeployToolsetCompiler/DeployToolsetCompiler.csproj
deleted file mode 100644
index 7722570..0000000
--- a/src/Deployment/DeployToolsetCompiler/DeployToolsetCompiler.csproj
+++ /dev/null
@@ -1,33 +0,0 @@
-﻿<?xml version="1.0" encoding="utf-8"?>
-<!-- Copyright (c)  Microsoft.  All Rights Reserved.  Licensed under the Apache License, Version 2.0.  See License.txt in the project root for license information. -->
-<Project ToolsVersion="14.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
-  <Import Project="..\..\..\build\Targets\Settings.props" />
-  <PropertyGroup>
-    <Platform Condition="'$(Platform)' == ''">AnyCPU</Platform>
-    <PlatformTarget>AnyCPU</PlatformTarget>
-    <ProjectGuid>{57557F32-0635-421A-BCF8-549AED50F764}</ProjectGuid>
-    <OutputType>Exe</OutputType>
-    <RootNamespace>DeployToolsetCompiler</RootNamespace>
-    <AssemblyName>DeployToolsetCompiler_DoNotUse</AssemblyName>
-    <TargetFrameworkVersion>v4.6</TargetFrameworkVersion>
-    <AutoGenerateBindingRedirects>true</AutoGenerateBindingRedirects>
-  </PropertyGroup>
-  <PropertyGroup Condition="'$(Configuration)|$(Platform)' == 'Debug|AnyCPU'" />
-  <PropertyGroup Condition="'$(Configuration)|$(Platform)' == 'Release|AnyCPU'" />
-  <ItemGroup>
-    <Reference Include="System" />
-  </ItemGroup>
-  <ItemGroup>
-    <Compile Include="Program.cs" />
-  </ItemGroup>
-  <ItemGroup>
-    <None Include="project.json" />
-  </ItemGroup>
-  <ItemGroup>
-    <ProjectReference Include="..\..\Compilers\Core\MSBuildTask\MSBuildTask.csproj">
-      <Project>{7ad4fe65-9a30-41a6-8004-aa8f89bcb7f3}</Project>
-      <Name>MSBuildTask</Name>
-    </ProjectReference>
-  </ItemGroup>
-  <Import Project="..\..\..\build\Targets\Imports.targets" />
-</Project>
\ No newline at end of file
diff --git a/src/Deployment/DeployToolsetCompiler/Program.cs b/src/Deployment/DeployToolsetCompiler/Program.cs
deleted file mode 100644
index 72c3f19..0000000
--- a/src/Deployment/DeployToolsetCompiler/Program.cs
+++ /dev/null
@@ -1,9 +0,0 @@
-﻿namespace DoNotUse
-{
-    public class Program
-    {
-        private static void Main(string[] args)
-        {
-        }
-    }
-}
diff --git a/src/Deployment/DeployToolsetCompiler/project.json b/src/Deployment/DeployToolsetCompiler/project.json
deleted file mode 100644
index 50182c1..0000000
--- a/src/Deployment/DeployToolsetCompiler/project.json
+++ /dev/null
@@ -1,11 +0,0 @@
-﻿{
-  "dependencies": { },
-  "frameworks": {
-    "net46": { }
-  },
-  "runtimes": {
-    "win7": { },
-    "ubuntu.14.04": { },
-    "osx.10.10": { }
-  }
-}
-- 
1.8.3.1

